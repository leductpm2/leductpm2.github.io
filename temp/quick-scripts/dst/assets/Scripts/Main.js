
                (function() {
                    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
                    var __module = nodeEnv ? module : {exports:{}};
                    var __filename = 'preview-scripts/assets/Scripts/Main.js';
                    var __require = nodeEnv ? function (request) {
                        return cc.require(request);
                    } : function (request) {
                        return __quick_compile_project__.require(request, __filename);
                    };
                    function __define (exports, require, module) {
                        if (!nodeEnv) {__quick_compile_project__.registerModule(__filename, module);}"use strict";
cc._RF.push(module, '82164HSS5xI54qt5wku0rKP', 'Main');
// Scripts/Main.js

"use strict";

var _socketIo = require("./socket.io.js");

// Learn cc.Class:
//  - https://docs.cocos.com/creator/manual/en/scripting/class.html
// Learn Attribute:
//  - https://docs.cocos.com/creator/manual/en/scripting/reference/attributes.html
// Learn life-cycle callbacks:
//  - https://docs.cocos.com/creator/manual/en/scripting/life-cycle-callbacks.html
var socket = null;
var playerMap = new Map();
var MainAPP = cc.Class({
  "extends": cc.Component,
  properties: {
    Player: {
      "default": null,
      type: cc.Prefab,
      serializable: true
    },
    playerID: {
      "default": "",
      visible: false
    }
  },
  statics: {
    instance: null
  },
  onPlayerMove: function onPlayerMove(posX, posY) {
    if (!cc.sys.isNative) {
      socket.emit('onPlayerMove', {
        "playerID": this.playerID,
        "posX": posX,
        "posY": posY
      });
    }
  },
  onPlayerShoot: function onPlayerShoot(posX, posY) {
    if (!cc.sys.isNative) {
      socket.emit('onPlayerShoot', {
        "playerID": this.playerID,
        "posX": posX,
        "posY": posY
      });
    }
  },
  updatePlayers: function updatePlayers(value, key, map) {
    console.log("m[".concat(key, "] = ").concat(value));
    var playerData = playerMap.get(key);

    if (!playerData) {
      var player = cc.instantiate(MainAPP.instance.Player);
      player.getComponent("Player").playerID = key;
      console.log("Create Player:", key, "==", MainAPP.instance.playerID, "==", key == this.playerID);
      player.setPosition(value.posX, value.posY);
      MainAPP.instance.node.addChild(player);
      playerMap.set(key, {
        "node": player,
        "playerID": key,
        "posX": value.posX,
        "posY": value.posY
      });
    } else {
      playerData.node.setPosition(value.posX, value.posY);
    }
  },
  serverHandler: function serverHandler() {
    var _this = this;

    if (!cc.sys.isNative) {
      socket = (0, _socketIo.connect)('https://space-shooter-cocos.herokuapp.com');
      socket.on('connect', function () {
        _this.playerID = socket.id;
        console.log('Socket connected id:', _this.playerID);
        socket.emit('CreatePlayer', 'Hello Server');
        socket.on('CreatePlayerResponse', function (data) {
          var newMap = new Map(JSON.parse(data));
          newMap.forEach(_this.updatePlayers);
        });
        socket.on('onPlayerMoveResponse', function (data) {
          var newMap = new Map(JSON.parse(data));
          newMap.forEach(_this.updatePlayers);
        });
        socket.on('onPlayerShootResponse', function (data) {
          if (playerMap.has(data.playerID)) {
            var playerData = playerMap.get(data.playerID);
            playerData.node.getComponent("Player").shoot(data.playerID, data.posX, data.posY);
          } else {
            console.log("onPlayerShootResponse not found player ", data.playerID);
          }
        });
        socket.on('playerDisconect', function (data) {
          if (playerMap.has(data)) {
            console.log("playerDisconect Client");
            playerMap.get(data).node.destroy();
          }
        });
      });
    }
  },
  onLoad: function onLoad() {
    MainAPP.instance = this;
    this.serverHandler();
  },
  start: function start() {} // update (dt) {},

});

cc._RF.pop();
                    }
                    if (nodeEnv) {
                        __define(__module.exports, __require, __module);
                    }
                    else {
                        __quick_compile_project__.registerModuleFunc(__filename, function () {
                            __define(__module.exports, __require, __module);
                        });
                    }
                })();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFzc2V0c1xcU2NyaXB0c1xcTWFpbi5qcyJdLCJuYW1lcyI6WyJzb2NrZXQiLCJwbGF5ZXJNYXAiLCJNYXAiLCJNYWluQVBQIiwiY2MiLCJDbGFzcyIsIkNvbXBvbmVudCIsInByb3BlcnRpZXMiLCJQbGF5ZXIiLCJ0eXBlIiwiUHJlZmFiIiwic2VyaWFsaXphYmxlIiwicGxheWVySUQiLCJ2aXNpYmxlIiwic3RhdGljcyIsImluc3RhbmNlIiwib25QbGF5ZXJNb3ZlIiwicG9zWCIsInBvc1kiLCJzeXMiLCJpc05hdGl2ZSIsImVtaXQiLCJvblBsYXllclNob290IiwidXBkYXRlUGxheWVycyIsInZhbHVlIiwia2V5IiwibWFwIiwiY29uc29sZSIsImxvZyIsInBsYXllckRhdGEiLCJnZXQiLCJwbGF5ZXIiLCJpbnN0YW50aWF0ZSIsImdldENvbXBvbmVudCIsInNldFBvc2l0aW9uIiwibm9kZSIsImFkZENoaWxkIiwic2V0Iiwic2VydmVySGFuZGxlciIsIm9uIiwiaWQiLCJkYXRhIiwibmV3TWFwIiwiSlNPTiIsInBhcnNlIiwiZm9yRWFjaCIsImhhcyIsInNob290IiwiZGVzdHJveSIsIm9uTG9hZCIsInN0YXJ0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7OztBQU1BOztBQU5BO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUVBLElBQUlBLE1BQU0sR0FBRyxJQUFiO0FBQ0EsSUFBSUMsU0FBUyxHQUFHLElBQUlDLEdBQUosRUFBaEI7QUFDQSxJQUFJQyxPQUFPLEdBQUdDLEVBQUUsQ0FBQ0MsS0FBSCxDQUFTO0FBQ25CLGFBQVNELEVBQUUsQ0FBQ0UsU0FETztBQUduQkMsRUFBQUEsVUFBVSxFQUFFO0FBQ1JDLElBQUFBLE1BQU0sRUFBRTtBQUNKLGlCQUFTLElBREw7QUFFSkMsTUFBQUEsSUFBSSxFQUFFTCxFQUFFLENBQUNNLE1BRkw7QUFHSkMsTUFBQUEsWUFBWSxFQUFFO0FBSFYsS0FEQTtBQU1SQyxJQUFBQSxRQUFRLEVBQUM7QUFD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aUJBQVYsRUFBNkIsVUFBQ0UsSUFBRCxFQUFVO0FBQ3BDLGNBQUd4QyxTQUFTLENBQUM2QyxHQUFWLENBQWNMLElBQWQsQ0FBSCxFQUNBO0FBQ0tkLFlBQUFBLE9BQU8sQ0FBQ0MsR0FBUixDQUFZLHdCQUFaO0FBQ0EzQixZQUFBQSxTQUFTLENBQUM2QixHQUFWLENBQWNXLElBQWQsRUFBb0JOLElBQXBCLENBQXlCYSxPQUF6QjtBQUNKO0FBQ0gsU0FORDtBQU9KLE9BbENEO0FBbUNIO0FBQ0osR0FqR2tCO0FBa0duQkMsRUFBQUEsTUFsR21CLG9CQWtHVDtBQUNOOUMsSUFBQUEsT0FBTyxDQUFDWSxRQUFSLEdBQW1CLElBQW5CO0FBQ0EsU0FBS3VCLGFBQUw7QUFDSCxHQXJHa0I7QUF1R25CWSxFQUFBQSxLQXZHbUIsbUJBdUdWLENBRVIsQ0F6R2tCLENBMkduQjs7QUEzR21CLENBQVQsQ0FBZCIsInNvdXJjZVJvb3QiOiIvIiwic291cmNlc0NvbnRlbnQiOlsiLy8gTGVhcm4gY2MuQ2xhc3M6XHJcbi8vICAtIGh0dHBzOi8vZG9jcy5jb2Nvcy5jb20vY3JlYXRvci9tYW51YWwvZW4vc2NyaXB0aW5nL2NsYXNzLmh0bWxcclxuLy8gTGVhcm4gQXR0cmlidXRlOlxyXG4vLyAgLSBodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9yZWZlcmVuY2UvYXR0cmlidXRlcy5odG1sXHJcbi8vIExlYXJuIGxpZmUtY3ljbGUgY2FsbGJhY2tzOlxyXG4vLyAgLSBodHRwczovL2RvY3MuY29jb3MuY29tL2NyZWF0b3IvbWFudWFsL2VuL3NjcmlwdGluZy9saWZlLWN5Y2xlLWNhbGxiYWNrcy5odG1sXHJcbmltcG9ydCB7IGNvbm5lY3QgfSBmcm9tICcuL3NvY2tldC5pby5qcyc7XHJcbnZhciBzb2NrZXQgPSBudWxsO1xyXG5sZXQgcGxheWVyTWFwID0gbmV3IE1hcCgpXHJcbnZhciBNYWluQVBQID0gY2MuQ2xhc3Moe1xyXG4gICAgZXh0ZW5kczogY2MuQ29tcG9uZW50LFxyXG5cclxuICAgIHByb3BlcnRpZXM6IHtcclxuICAgICAgICBQbGF5ZXI6IHtcclxuICAgICAgICAgICAgZGVmYXVsdDogbnVsbCwgICAgICAgXHJcbiAgICAgICAgICAgIHR5cGU6IGNjLlByZWZhYiwgXHJcbiAgICAgICAgICAgIHNlcmlhbGl6YWJsZTogdHJ1ZSwgXHJcbiAgICAgICAgfSxcclxuICAgICAgICBwbGF5ZXJJRDp7XHJcbiAgICAgICAgICAgIGRlZmF1bHQ6IFwiXCIsXHJcbiAgICAgICAgICAgIHZpc2libGU6IGZhbHNlLFxyXG4gICAgICAgIH0gICAgICAgXHJcbiAgICB9LFxyXG4gICAgc3RhdGljczp7XHJcbiAgICAgICAgaW5zdGFuY2U6IG51bGwsXHJcbiAgICB9LFxyXG4gICAgb25QbGF5ZXJNb3ZlKHBvc1gsIHBvc1kpIHtcclxuICAgICAgICBpZiAoIWNjLnN5cy5pc05hdGl2ZSkgeyAgICAgICAgICBcclxuICAgICAgICAgICAgc29ja2V0LmVtaXQoJ29uUGxheWVyTW92ZScsIHsgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICBcInBsYXllcklEXCI6IHRoaXMucGxheWVySUQsXHJcbiAgICAgICAgICAgICAgICBcInBvc1hcIjogcG9zWCxcclxuICAgICAgICAgICAgICAgIFwicG9zWVwiOiBwb3NZLFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9LFxyXG4gICAgb25QbGF5ZXJTaG9vdChwb3NYLCBwb3NZKSB7XHJcbiAgICAgICAgaWYgKCFjYy5zeXMuaXNOYXRpdmUpIHsgICAgICAgICAgXHJcbiAgICAgICAgICAgIHNvY2tldC5lbWl0KCdvblBsYXllclNob290JywgeyAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIFwicGxheWVySURcIjogdGhpcy5wbGF5ZXJJRCxcclxuICAgICAgICAgICAgICAgIFwicG9zWFwiOiBwb3NYLFxyXG4gICAgICAgICAgICAgICAgXCJwb3NZXCI6IHBvc1ksXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuICAgIH0sXHJcbiAgICB1cGRhdGVQbGF5ZXJzKHZhbHVlLCBrZXksIG1hcCkge1xyXG5cclxuICAgICAgICBjb25zb2xlLmxvZyhgbVske2tleX1dID0gJHt2YWx1ZX1gKTtcclxuICAgICAgICBsZXQgcGxheWVyRGF0YSA9IHBsYXllck1hcC5nZXQoa2V5KTtcclxuICAgICAgICBpZighcGxheWVyRGF0YSlcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIHZhciBwbGF5ZXIgPSBjYy5pbnN0YW50aWF0ZShNYWluQVBQLmluc3RhbmNlLlBsYXllcik7ICBcclxuICAgICAgICAgICAgcGxheWVyLmdldENvbXBvbmVudChcIlBsYXllclwiKS5wbGF5ZXJJRCA9IGtleTtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJDcmVhdGUgUGxheWVyOlwiLCBrZXkgLFwiPT1cIiwgTWFpbkFQUC5pbnN0YW5jZS5wbGF5ZXJJRCxcIj09XCIsIGtleSA9PSB0aGlzLnBsYXllcklEKTsgXHJcbiAgICAgICAgICAgIHBsYXllci5zZXRQb3NpdGlvbih2YWx1ZS5wb3NYLCB2YWx1ZS5wb3NZKTsgICAgICAgIFxyXG4gICAgICAgICAgICBNYWluQVBQLmluc3RhbmNlLm5vZGUuYWRkQ2hpbGQocGxheWVyKTsgICBcclxuICAgICAgICAgICAgcGxheWVyTWFwLnNldChrZXksIHtcclxuICAgICAgICAgICAgICAgIFwibm9kZVwiOiBwbGF5ZXIsXHJcbiAgICAgICAgICAgICAgICBcInBsYXllcklEXCI6IGtleSxcclxuICAgICAgICAgICAgICAgIFwicG9zWFwiOiB2YWx1ZS5wb3NYLFxyXG4gICAgICAgICAgICAgICAgXCJwb3NZXCI6IHZhbHVlLnBvc1lcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2VcclxuICAgICAgICB7ICAgICAgICAgXHJcbiAgICAgICAgICAgIHBsYXllckRhdGEubm9kZS5zZXRQb3NpdGlvbih2YWx1ZS5wb3NYLCB2YWx1ZS5wb3NZKTtcclxuICAgICAgICB9ICAgICAgIFxyXG4gICAgfSxcclxuICAgIHNlcnZlckhhbmRsZXIoKXtcclxuICAgICAgICBpZiAoIWNjLnN5cy5pc05hdGl2ZSkge1xyXG4gICAgICAgICAgICBzb2NrZXQgPSBjb25uZWN0KCdodHRwczovL3NwYWNlLXNob290ZXItY29jb3MuaGVyb2t1YXBwLmNvbScpOyAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBzb2NrZXQub24oJ2Nvbm5lY3QnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXllcklEID0gc29ja2V0LmlkO1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ1NvY2tldCBjb25uZWN0ZWQgaWQ6JywgdGhpcy5wbGF5ZXJJRCk7ICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgc29ja2V0LmVtaXQoJ0NyZWF0ZVBsYXllcicsICdIZWxsbyBTZXJ2ZXInKTtcclxuICAgICAgICAgICAgICAgIHNvY2tldC5vbignQ3JlYXRlUGxheWVyUmVzcG9uc2UnLCAoZGF0YSkgPT4geyAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgIHZhciBuZXdNYXAgPSBuZXcgTWFwKEpTT04ucGFyc2UoZGF0YSkpOyAgICAgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgICAgICBuZXdNYXAuZm9yRWFjaCh0aGlzLnVwZGF0ZVBsYXllcnMpOyAgICBcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIHNvY2tldC5vbignb25QbGF5ZXJNb3ZlUmVzcG9uc2UnLCAoZGF0YSkgPT4geyAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgdmFyIG5ld01hcCA9IG5ldyBNYXAoSlNPTi5wYXJzZShkYXRhKSk7ICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgICAgbmV3TWFwLmZvckVhY2godGhpcy51cGRhdGVQbGF5ZXJzKTsgICAgICAgICAgICAgICBcclxuICAgICAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgc29ja2V0Lm9uKCdvblBsYXllclNob290UmVzcG9uc2UnLCAoZGF0YSkgPT4geyBcclxuICAgICAgICAgICAgICAgICAgICBpZihwbGF5ZXJNYXAuaGFzKGRhdGEucGxheWVySUQpKVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBsYXllckRhdGEgPSBwbGF5ZXJNYXAuZ2V0KGRhdGEucGxheWVySUQpOyAgICAgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJEYXRhLm5vZGUuZ2V0Q29tcG9uZW50KFwiUGxheWVyXCIpLnNob290KGRhdGEucGxheWVySUQsIGRhdGEucG9zWCwgZGF0YS5wb3NZKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZVxyXG4gICAgICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJvblBsYXllclNob290UmVzcG9uc2Ugbm90IGZvdW5kIHBsYXllciBcIiwgZGF0YS5wbGF5ZXJJRCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfSAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgICAgICAgICAgIHNvY2tldC5vbigncGxheWVyRGlzY29uZWN0JywgKGRhdGEpID0+IHsgXHJcbiAgICAgICAgICAgICAgICAgICAgaWYocGxheWVyTWFwLmhhcyhkYXRhKSlcclxuICAgICAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInBsYXllckRpc2NvbmVjdCBDbGllbnRcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICBwbGF5ZXJNYXAuZ2V0KGRhdGEpLm5vZGUuZGVzdHJveSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pOyBcclxuICAgICAgICB9IFxyXG4gICAgfSxcclxuICAgIG9uTG9hZCAoKSB7ICBcclxuICAgICAgICBNYWluQVBQLmluc3RhbmNlID0gdGhpcztcclxuICAgICAgICB0aGlzLnNlcnZlckhhbmRsZXIoKTtcclxuICAgIH0sXHJcblxyXG4gICAgc3RhcnQgKCkge1xyXG5cclxuICAgIH0sXHJcblxyXG4gICAgLy8gdXBkYXRlIChkdCkge30sXHJcbn0pO1xyXG4iXX0=